{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Battery Bank vemonitor configuration",
    "type" : "object",
    "additionalProperties": false,
    "properties" : {
        "batteryDatas": {
            "description": "Batteries data configuration data.",
            "type": "object",
            "properties" : {
                "batteries": {
                    "description": "Batteries items properties.",
                    "type": "object",
                    "minProperties": 1,
                    "maxProperties": 20,
                    "propertyNames": {
                        "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
                    },
                    "additionalProperties": {
                        "description": "Single Battery item properties..",
                        "$ref": "/schemas/battery"
                    }
                },
                "bankItems": {
                    "description": "Battery banks properties.", 
                    "type": "object",
                    "minProperties": 1,
                    "maxProperties": 20,
                    "propertyNames": {
                        "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
                    },
                    "additionalProperties": {
                        "description": "Single Battery bank properties.", 
                        "type": "object",
                        "minProperties": 1,
                        "maxProperties": 7,
                        "additionalProperties": false,
                        "required": [ "battery_key" ],
                        "properties" : {
                            "battery_key": {
                                "description": "Battery key fom batteryDatas.",
                                "$ref": "/schemas/battery_key"
                            },
                            "in_series": {
                                "description": "Number of Batteries in series.",
                                "$ref": "/schemas/bank_couplage"
                            },
                            "in_parallel": {
                                "description": "Number of Batteries in parallel.",
                                "$ref": "/schemas/bank_couplage"
                            },
                            "system_voltage": {
                                "$ref": "/schemas/system_voltage"
                            },
                            "t_bat": {
                                "description": "Model name of the battery.",
                                "$ref": "/schemas/temp_value_item"
                            },
                            "t_loc": {
                                "description": "Local Temperrature Value of Battery Bank.",
                                "$ref": "/schemas/temp_value_item"
                            },
                            "charge_settings": {
                                "$ref": "/schemas/charge_settings"
                            }
                        }
                    }
        
                }
            }
        },
        "batteryBankArgs": {
            "type": "object",
            "minProperties": 6,
            "maxProperties": 9,
            "additionalProperties": false,
            "required": [ "battery_key", "battery" ],
            "properties" : {
                "name": {
                    "description": "Name of BatteryBank.", 
                    "$ref": "/schemas/name"
                },
                "battery_key": {
                    "description": "Battery key fom batteryDatas.",
                    "$ref": "/schemas/battery_key"
                },
                "battery": {
                    "$ref": "/schemas/battery"
                },
                "in_series": {
                    "description": "Number of Batteries in series.",
                    "$ref": "/schemas/bank_couplage"
                },
                "in_parallel": {
                    "description": "Number of Batteries in parallel.",
                    "$ref": "/schemas/bank_couplage"
                },
                "system_voltage": {
                    "$ref": "/schemas/system_voltage"
                },
                "t_bat": {
                    "description": "Model name of the battery.",
                    "$ref": "/schemas/temp_value_item"
                },
                "t_loc": {
                    "description": "Local Temperrature Value of Battery Bank.",
                    "$ref": "/schemas/temp_value_item"
                },
                "charge_settings": {
                    "$ref": "/schemas/charge_settings"
                }
            }
        }
    },
    "$defs": {
        "battery": {
            "$id": "/schemas/battery",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Battery item.",
            "type": "object",
            "minProperties": 1,
            "maxProperties": 8,
            "additionalProperties": false,
            "required": [ "battery_type" ],
            "properties" : {
                "manufacturer": {
                    "description": "Manufacturer name of the battery.",
                    "$ref": "/schemas/manufacturer"
                },
                "model": {
                    "description": "Model name of the battery.",
                    "$ref": "/schemas/model"
                },
                "battery_type": {
                    "$ref": "/schemas/battery_type"
                },
                "bat_voltage": {
                    "description": "Voltage of battery.",
                    "$ref": "/schemas/bat_voltage"
                },
                "cell_voltage": {
                    "description": "Voltage of single battery cell.",
                    "$ref": "/schemas/bat_voltage"
                },
                "nb_cells": {
                    "description": "Number of battery cells.",
                    "$ref": "/schemas/nb_cells"
                },
                "charge_settings": {
                    "$ref": "/schemas/charge_settings"
                },
                "capacity": {
                    "$ref": "/schemas/capacity"
                }
            }
        },
        "manufacturer": {
            "$id": "/schemas/manufacturer",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Manufacturer name of the battery.",
            "type": "string",
            "pattern": "(?=[a-zA-Z0-9_\\-./ ]{1,30}$)^([a-zA-Z0-9 ]+(?:_[a-zA-Z0-9\\-./ ]+)*(?:[a-zA-Z0-9\\-./ ]+)*)$"
        },
        "model": {
            "$id": "/schemas/model",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Model name of the battery.",
            "type": "string",
            "pattern": "(?=[a-zA-Z0-9_\\-./ ]{1,30}$)^([a-zA-Z0-9 ]+(?:_[a-zA-Z0-9\\-./ ]+)*(?:[a-zA-Z0-9\\-./ ]+)*)$"
        },
        "battery_type": {
            "$id": "/schemas/battery_type",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Type of Batteries.", 
            "type": "string",
            "emum": ["flooded", "gel", "agm", "li"],
            "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
        },
        "bat_voltage": {
            "$id": "/schemas/bat_voltage",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Voltage of single battery cell.",
            "type": "number",
            "exclusiveMinimum": 0,
            "maximum": 1000
        },
        "nb_cells": {
            "$id": "/schemas/nb_cells",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Number of battery cells.",
            "type": "integer",
            "minimum": 1,
            "maximum": 1000
        },
        "bat_charge_v": {
            "$id": "/schemas/bat_charge_v",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Battery charge voltage.",
            "type": "number",
            "exclusiveMinimum": 0,
            "maximum": 1000
        },
        "charge_settings": {
            "$id": "/schemas/charge_settings",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Battery Charge Settings.",
            "type": "object",
            "minProperties": 1,
            "maxProperties": 5,
            "additionalProperties": false,
            "required": [ ],
            "properties" : {
                "charge_t_coef": {
                    "$ref": "/schemas/charge_t_coef"
                },
                "charge_absorption_u": {
                    "description": "Bulk Voltage of single battery cell.",
                    "$ref": "/schemas/bat_charge_v"
                },
                "charge_float_u": {
                    "description": "Float Voltage of single battery cell.",
                    "$ref": "/schemas/bat_charge_v"
                },
                "charge_storage_u": {
                    "description": "Storage Voltage of single battery cell.",
                    "$ref": "/schemas/bat_charge_v"
                },
                "charge_egalization_u": {
                    "description": "Equalization Voltage of single battery cell.",
                    "$ref": "/schemas/bat_charge_v"
                }
            }
        },
        "capacity": {
            "$id": "/schemas/capacity",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Battery capacity Array values.",
            "type": "array",
            "minItems": 1,
            "maxItems": 300,
            "items": {
                "description": "Battery capacity Array columns (hour rate, capacity, current).",
                "type": "array",
                "minItems": 3,
                "maxItems": 3,
                "prefixItems": [
                    { 
                        "description": "Battery hour rate value",
                        "type": "number",
                        "minimum": 1,
                        "maximum": 100
                    },
                    { 
                        "description": "Battery capacity value",
                        "type": "number",
                        "minimum": 1,
                        "maximum": 100000
                    },
                    {
                        "description": "Battery current value", 
                        "type": "number",
                        "minimum": 0.001,
                        "maximum": 100000
                    }
                ]
            }
        },
        "name": {
            "$id": "/schemas/name",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Name.", 
            "type": "string",
            "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
        },
        "battery_key": {
            "$id": "/schemas/battery_key",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Battery key fom batteryDatas.",
            "type": "string",
            "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
        },
        "bank_couplage": {
            "$id": "/schemas/bank_couplage",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Number of Batteries in series or in parallel.",
            "type": "integer",
            "minimum": 1,
            "maximum": 1000
        },
        "system_voltage": {
            "$id": "/schemas/system_voltage",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "System Voltage of Battery bank.",
            "type": "number",
            "minimum": 2,
            "maximum": 48
        },
        "temp_source": {
            "$id": "/schemas/temp_source",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Source of Temperrature data value.", 
            "type": "string",
            "emum": ["fixed", "node", "cache"],
            "pattern": "(?=[a-zA-Z0-9_]{1,30}$)^([a-zA-Z0-9]+(?:_[a-zA-Z0-9]+)*)$"
        },
        "charge_t_coef": {
            "$id": "/schemas/charge_t_coef",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Temperrature coeficient for charge correction.",
            "type": "number",
            "minimum": -1000.0,
            "maximum": 1000.0
        },
        "temp_value": {
            "$id": "/schemas/temp_value",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Temperrature Value.",
            "type": "number",
            "minimum": -70.0,
            "maximum": 120.0
        },
        "temp_value_item": {
            "$id": "/schemas/temp_value_item",
            "$schema": "http://json-schema.org/draft-07/schema#",
            "description": "Temperrature value Item.",
            "type": "object",
            "minProperties": 2,
            "maxProperties": 3,
            "additionalProperties": false,
            "required": [ "source" ],
            "properties" : {
                "source": {
                    "$ref": "/schemas/temp_source"
                },
                "node_name": {
                    "description": "Temperrature Source Node Name.",
                    "$ref": "/schemas/name"
                },
                "value": {
                    "description": "Fixed Temperrature value.",
                    "$ref": "/schemas/temp_value"
                }
            }
        }
    }
}